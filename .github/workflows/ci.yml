# CI/CD Pipeline
# Runs tests, linting, type checking, and security scans.
#
# Features:
#   - Standard quality checks (tests, linting, type checking)
#   - Security scanning (Bandit, Safety)
#   - Optional SonarCloud/Codecov integration
name: CI

on:
  push:
    branches: [main, master, develop]
  pull_request:
    types: [opened, synchronize, reopened]
    branches: [main, master, develop]
  workflow_dispatch:

# Cancel in-progress runs for same PR/branch
concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

permissions:
  contents: read
  pull-requests: write
  checks: write

# Uses org-level reusable workflow
jobs:
  ci:
    name: CI Pipeline
    uses: ByronWilliamsCPA/.github/.github/workflows/python-ci.yml@main
    with:
      python-version: '3.12'
      coverage-threshold: 80
      source-directory: 'src'
      test-directory: 'tests'
      enable-sonarcloud: true
      sonarcloud-organization: 'ByronWilliamsCPA'
      sonarcloud-project-key: 'ByronWilliamsCPA_template_sample'
      enable-codecov: true
      run-integration-tests: true
      run-security-tests: true
      fail-on-llm-tags: false
    secrets:
      SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
      CODECOV_TOKEN: ${{ secrets.CODECOV_TOKEN }}
